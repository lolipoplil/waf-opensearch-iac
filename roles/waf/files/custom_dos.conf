# Инициализируем коллекцию для хранения данных об IP (на 60 секунд)
SecAction "id:100002,phase:1,nolog,pass,initcol:IP=%{REMOTE_ADDR}"

# Проверяем: если счетчик больше 100, блокируем и выдаем ошибку 429 (Too Many Requests)
SecRule IP:COUNT "@gt 100" "id:100003,phase:1,deny,status:429,msg:'Potential DoS Attack Detected'"

# Увеличиваем счетчик при каждом запросе
SecAction "id:100004,phase:5,nolog,pass,setvar:IP.COUNT=+1,expirevar:IP.COUNT=60"
